<!DOCTYPE html>

<html>
  <head>
    <title>Applied BioCode Barcode Encoder/Decoder</title>

    <style>
		body {
			background-color: white;
		}

    .instructions {
      max-width: 600px;
      margin: 30px auto 0 auto;
    }

    .instructions p, li {
      line-height: 1.3;
    }

    .instructions ul li {
      margin-bottom : 1ex;
    }

    
    /* Format the barcode representation SVG */
    .bit-unset {
      fill: #000000;
      fill-opacity: 0;
    }
    
    .bit-set {
      fill: #000000;
      fill-opacity: 1;
    }
    
    /* Change the color of the box upon hover */
    .bit-unset.hover {
      fill-opacity: 0.15;
    }
    
    .bit-set.hover {
      fill-opacity: 0.60;
    }
		
		/* Format the barcode number box */
		#barcode-value {
			font-size: x-large;
			width: 7ch;
			margin-top:	30px;
			text-align:	center;
			font-weight: bold;
		}

    </style>

    
  </head>

  <body>

    <div style="width:100%; height:100%; margin:0 auto">

      <div style="width:100%; height:100%; margin:0 auto; text-align:center">
        <h1>Applied Biocode Barcode Encoder/Decoder</h1>
        <h3>by Jeff Stevens</h3>
      </div>


      <div id="content" style="display:block; margin:0 auto;">

        <br /><br />

        <div id="svg" style="display:block; margin:0 auto">
          
		    <!-- Embed the SVG, to keep the document self-contained. -->
		  
          <svg id="bead" style="display:block; margin:0 auto"
             xmlns:dc="http://purl.org/dc/elements/1.1/"
             xmlns:cc="http://creativecommons.org/ns#"
             xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
             xmlns:svg="http://www.w3.org/2000/svg"
             xmlns="http://www.w3.org/2000/svg"
             xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
             xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
             width="68.5mm"
             height="40.5mm"
             viewBox="0 0 242.71654 143.50394"
             version="1.1"
             inkscape:version="0.91 r13725"
             sodipodi:docname="Bead barcode template.svg">
            <defs
               id="defs4" />
            <sodipodi:namedview
               id="base"
               pagecolor="#ffffff"
               bordercolor="#666666"
               borderopacity="1.0"
               inkscape:pageopacity="0.0"
               inkscape:pageshadow="2"
               inkscape:zoom="0.99999999"
               inkscape:cx="107.48634"
               inkscape:cy="80.201731"
               inkscape:document-units="mm"
               inkscape:current-layer="layer1"
               showgrid="false"
               fit-margin-top="0"
               fit-margin-left="0"
               fit-margin-right="0"
               fit-margin-bottom="0"
               inkscape:window-width="1280"
               inkscape:window-height="738"
               inkscape:window-x="-8"
               inkscape:window-y="-8"
               inkscape:window-maximized="1" />
            <metadata
               id="metadata7">
              <rdf:RDF>
                <cc:Work
                   rdf:about="">
                  <dc:format>image/svg+xml</dc:format>
                  <dc:type
                     rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                  <dc:title />
                </cc:Work>
              </rdf:RDF>
            </metadata>
            <g
               inkscape:label="Layer 1"
               inkscape:groupmode="layer"
               id="layer1"
               transform="translate(-100.12942,-79.709632)">
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill:none;fill-opacity:1;fill-rule:nonzero;stroke:#000000;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="rect4136"
                 width="240.94489"
                 height="141.73228"
                 x="101.01525"
                 y="80.595459" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="rect4138"
                 width="21.259842"
                 height="106.29921"
                 x="117.84595"
                 y="99.197823" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="rect4138-4"
                 width="21.259842"
                 height="106.29921"
                 x="302.09793"
                 y="99.197823" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="rect4138-5"
                 width="35.433071"
                 height="21.259842"
                 x="245.40501"
                 y="99.197823" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="rect4138-5-0"
                 width="21.259842"
                 height="21.259842"
                 x="160.36563"
                 y="141.71751" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="rect4138-5-0-6"
                 width="21.259842"
                 height="21.259842"
                 x="160.36563"
                 y="99.197823" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="rect4138-5-0-8"
                 width="21.259842"
                 height="21.259842"
                 x="202.88531"
                 y="184.2372" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="rect4138-5-0-8-3"
                 width="21.259842"
                 height="21.259842"
                 x="202.88531"
                 y="141.71751" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="rect4138-5-0-8-3-5"
                 width="21.259842"
                 height="21.259842"
                 x="202.88531"
                 y="99.197823" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="rect4138-5-0-8-7"
                 width="21.259842"
                 height="21.259842"
                 x="245.40501"
                 y="184.2372" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="rect4138-5-0-8-7-4"
                 width="21.259842"
                 height="21.259842"
                 x="245.40501"
                 y="141.71751" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="rect4138-5-0-8-7-4-7"
                 width="21.259842"
                 height="21.259842"
                 x="160.36565"
                 y="184.2372" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="barcode-0"
                 width="21.259842"
                 height="21.259842"
                 x="181.62547"
                 y="99.197823"
                 inkscape:label="barcode-0" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="barcode-1"
                 width="21.259842"
                 height="21.259842"
                 x="224.14516"
                 y="99.197823"
                 inkscape:label="barcode-1" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="barcode-2"
                 width="21.259842"
                 height="21.259842"
                 x="160.36563"
                 y="120.45766"
                 inkscape:label="barcode-2" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="barcode-3"
                 width="21.259842"
                 height="21.259842"
                 x="202.88531"
                 y="120.45766"
                 inkscape:label="barcode-3" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="barcode-4"
                 width="21.259842"
                 height="21.259842"
                 x="245.40501"
                 y="120.45766"
                 inkscape:label="barcode-4" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="barcode-5"
                 width="21.259842"
                 height="21.259842"
                 x="181.62547"
                 y="141.71751"
                 inkscape:label="barcode-5" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="barcode-6"
                 width="21.259842"
                 height="21.259842"
                 x="224.14516"
                 y="141.71751"
                 inkscape:label="barcode-6" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="barcode-7"
                 width="21.259842"
                 height="21.259842"
                 x="160.36563"
                 y="162.97736"
                 inkscape:label="barcode-7" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="barcode-8"
                 width="21.259842"
                 height="21.259842"
                 x="202.88531"
                 y="162.97736"
                 inkscape:label="barcode-8" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="barcode-9"
                 width="21.259842"
                 height="21.259842"
                 x="245.40501"
                 y="162.97736"
                 inkscape:label="barcode-9" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="barcode-10"
                 width="21.259842"
                 height="21.259842"
                 x="181.62547"
                 y="184.2372"
                 inkscape:label="barcode-10" />
              <rect
                 style="color:#000000;display:inline;overflow:visible;visibility:visible;opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate"
                 id="barcode-11"
                 width="21.259842"
                 height="21.259842"
                 x="224.14516"
                 y="184.2372"
                 inkscape:label="barcode-11" />
            </g>
          </svg>
          

        </div>


		    <!-- Display the barcode number box -->
		
        <div style="display:block; margin:0 auto; text-align: center;">
        
            <input type="number" id="barcode-value" name="barcode-value"
              min="0" max="4095" step="1" value="0">
              
        </div>


        <!-- Add some simple instructions -->

        <div class="instructions">
          <h3>Instructions</h3>

          <p>Applied BioCode (ABC) is a company that provides a novel
          bead-based multiplexing assay technology. Each 70 &micro;m &times;
          40 &micro;m bead is printed with a barcode, allowing multiple tests
          to be distinguished in the same biological sample.</p>

          <p>The barcodes are just a basic binary format, but are tedious to
          decode visually. This is a simple app to make decoding a snap! </p>

          <ul>
            <li>Hover the mouse over the bead image. Regions that turn gray
            represent the "bits" of the barcode. Click to "set" the bit;
            click again to "clear" the bit. The decoded barcode number will
            display in the number box above.</li>

            <li>Alternatively, enter a number between 0 and 4095 in the
            number box, and it will show what a bead of this barcode number
            looks like.</li>
          </ul>

          <p>Have fun!</p>
        </div>


      </div>

    </div>


    <script>
    
      // Reset the barcode number box upon load
      document.addEventListener("DOMContentLoaded", initialize);
      
      
      function getBoxState(box) {
      
        var classes = box.classList;
        var n = classes.length;
        
        var cls;
        for (var i = 0; i < n; i++) {
          
          cls = classes[i];
          if (cls == "bit-unset") {
            return 0;
          } else if (cls == "bit-set") {
            return 1;
          }
          // Ignore everything else...
        }
        
      }
      
      function setBoxState(box, state) {
        // state: 0 or 1
        
        if (state != 0 && state != 1) {
          throw "'state' must be 0 or 1.";
        }
        
        var classes = box.classList;
        
        if (state == 0) {
          classes.remove("bit-set");
          classes.add("bit-unset");
        } else if (state == 1) {
          classes.remove("bit-unset");
          classes.add("bit-set");
        }
        
      }
      
      
      function toggleBoxState(box) {
        var state = getBoxState(box);
        
        if (state == 0) {
          setBoxState(box, 1);
        } else if (state == 1) {
          setBoxState(box, 0);
        }
      }
      
      
      // Get the bit value of a barcode box
      function getBit(bit) {

        var box = document.getElementById("barcode-" + bit);
        
        var val = getBoxState(box);

        return val;
      }


      // Set or unset a barcode box
      function setBit(bit, val) {

        var box = document.getElementById("barcode-" + bit);
        
        setBoxState(box, val);
      }


      // Get the current barcode value from the SVG drawing
      function getBarcode() {

        var val = 0;
        var barcode = 0;

        for (var bit = 0; bit < 12; bit++) {

          // Need to count down here!
          val = getBit(11 - bit);

          barcode = barcode << 1;
          barcode = barcode | val;
        }

        return barcode;
      }


      // Set the barcode boxes in the SVG drawing to the specified barcode value
      function setBarcode(barcode) {

        var val;

        for (var bit = 0; bit < 12; bit++) {

          val = barcode & 1;
          setBit(bit, val);

          barcode = barcode >> 1;
        }
      }


      // Update the barcode representation based on the contents of the barcode
      // value input box
      function updateBarcode() {
      
        console.log("Updating the barcode representation...");
      
        // Get the input value
        var input = document.getElementById("barcode-value");
        var barcode = input.value;

        if (barcode !== null && !isNaN(barcode) &&
          /^([0-9]{1,3}|[0-3][0-9]{3}|40[0-8][0-9]|409[0-5])$/.test(barcode) ) {
          input.style["color"] = "black";
          setBarcode(barcode);
        } else {
          input.style["color"] = "red";
          setBarcode(0);
        }
      }


      // Toggle the bit state of a barcode box
      function toggleBox() {

        // First, toggle the state of the box.
        toggleBoxState(this);
        
        // Remove the hover state until the mouse leaves the box
        clearHoverState(this);
        
        // Now, update the barcode value
        var barcode = getBarcode();
        document.getElementById("barcode-value").value = barcode;
        updateBarcode();
      }
      
      
      // This may not be necessary...
      function getHoverState(box) {
        
        var classes = box.classList;
        var n = classes.length;
        
        // Try to find a "hover" item in the class list
        var cls;
        for (var i = 0; i < n; i++) {
          
          cls = classes[i];
          if (cls == "hover") return 1;
          
        }
        
        // This point will only be reached if the hover class isn't set
        return 0;
      }
      
      
      function setHoverState(box) {
      
        // Don't set it if the state is currently set
        var state = getHoverState(box);
        
        // Only add the class if the class hasn't already been added
        if (state == 0) {
          box.classList.add("hover");
        }
      
      }
      
      function clearHoverState(box) {
      
        // There should only be at most one "hover" item
        box.classList.remove("hover");
      }
    
    
      function initialize() {
      
        console.log("Starting initialization...");

        // Set the barcode value box and the barcode representation to 0
        document.getElementById("barcode-value").value = 0;
        updateBarcode();
        
        // Add the bead click handlers
        var box;
        for (var i = 0; i < 12; i++) {
          // Get the barcode box element
          box = document.getElementById("barcode-" + i);

          // Add the click handler
          box.addEventListener("click", toggleBox);
          
          // Change the box styling when the mouse enters/leaves the box
          box.addEventListener("mouseenter", function() {
            setHoverState(this);
          });
          box.addEventListener("mouseleave", function() {
            clearHoverState(this);
          });

          // Change the cursor when over a box
          box.style["cursor"] = "pointer";
          box.style["cursor"] = "hand";
        }
        
        // Update the barcode representation dynamically
        var input = document.getElementById("barcode-value");
        input.addEventListener("input", updateBarcode);
          
      }


    </script>

  </body>

</html>
